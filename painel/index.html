<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel | ConecTexxto</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">

  <style>
    .wrap{min-height:calc(100vh - 70px - 64px);padding:28px 20px 60px;}
    .panel{max-width:760px;margin:0 auto;}
    .box{background:#081426;border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.35);}
    textarea{width:100%;min-height:90px;border-radius:12px;padding:12px;border:1px solid rgba(30,144,255,.35);background:#050B18;color:#F5F7FA;outline:none;resize:none;}
    textarea:focus{border-color:#1E90FF;}
    .btn2{margin-top:10px;padding:10px 16px;border-radius:10px;border:none;background:#1E90FF;color:#fff;font-weight:600;cursor:pointer;}
    .post{margin-bottom:16px;}
    .post h4{margin-bottom:6px;}
    .post small{opacity:.6;}
  </style>
</head>

<body>
  <header>
    <div class="logo">Conec<span>Texxto</span></div>
    <nav>
      <a href="../">InÃ­cio</a>
      <a href="#" id="logout" class="btn">Sair</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="panel">

      <!-- NOVA POSTAGEM -->
      <div class="box">
        <h3>ðŸ’¬ Criar postagem</h3>
        <textarea id="content" placeholder="O que vocÃª estÃ¡ pensando?"></textarea>
        <button class="btn2" id="postBtn">Publicar</button>
      </div>

      <!-- FEED -->
      <div id="feed"></div>

    </section>
  </main>

  <footer>Â© 2026 ConecTexxto Â· Projeto em desenvolvimento</footer>

  <script type="module">
    import { supabase } from "../supabase.js";

    const feed = document.getElementById("feed");
    const postBtn = document.getElementById("postBtn");
    const contentInput = document.getElementById("content");

    // ProteÃ§Ã£o
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) window.location.href = "../login/";

    const user = session.user;

    // LOGOUT
    document.getElementById("logout").onclick = async () => {
      await supabase.auth.signOut();
      window.location.href = "../login/";
    };

    // CRIAR POST
    postBtn.onclick = async () => {
      const content = contentInput.value.trim();
      if (!content) return alert("Digite algo");

      const { error } = await supabase.from("posts").insert({
        user_id: user.id,
        content
      });

      if (error) return alert(error.message);

      contentInput.value = "";
      loadFeed();
    };

    // CARREGAR FEED
    async function loadFeed() {
      feed.innerHTML = "";

      const { data, error } = await supabase
        .from("posts")
        .select("content, created_at, profiles(nome)")
        .order("created_at", { ascending: false });

      if (error) {
        feed.innerHTML = "<p>Erro ao carregar feed</p>";
        return;
      }

      data.forEach(post => {
        const div = document.createElement("div");
        div.className = "box post";
        div.innerHTML = `
          <h4>${post.profiles?.nome || "UsuÃ¡rio"}</h4>
          <p>${post.content}</p>
          <small>${new Date(post.created_at).toLocaleString()}</small>
        `;
        feed.appendChild(div);
      });
    }

    loadFeed();
  </script>
</body>
</html>
